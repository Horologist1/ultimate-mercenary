<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Encuentros - Ultimate Mercenary</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_additional.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        .encounter-container {
            background-color: var(--medium-bg);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .encounter-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .encounter-header h2 {
            font-family: var(--header-font);
            color: var(--primary-color);
            text-shadow: 0 0 10px var(--primary-color);
        }

        .encounter-form {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: var(--primary-color);
            font-weight: bold;
        }

        .form-select, .form-input {
            width: 100%;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--primary-color);
            border-radius: 5px;
            color: var(--light-text);
        }

        .form-button {
            background-color: var(--darker-bg);
            color: var(--secondary-color);
            border: 1px solid var(--secondary-color);
            padding: 10px 20px;
            font-size: 1.1rem;
            border-radius: 5px;
            cursor: pointer;
            font-family: var(--header-font);
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .form-button:hover {
            background-color: var(--secondary-color);
            color: var(--darker-bg);
            box-shadow: 0 0 10px var(--secondary-color);
        }

        .encounter-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .encounter-card {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 242, 255, 0.3);
        }

        .encounter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.6);
            border-color: var(--primary-color);
        }

        .encounter-card-header {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-bottom: 1px solid var(--primary-color);
        }

        .encounter-card-title {
            font-family: var(--header-font);
            color: var(--primary-color);
            margin: 0;
            font-size: 1.2rem;
        }

        .encounter-card-body {
            padding: 15px;
        }

        .encounter-card-footer {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 10px 15px;
            border-top: 1px solid rgba(0, 242, 255, 0.2);
            display: flex;
            justify-content: space-between;
        }

        .save-button {
            background-color: var(--darker-bg);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .save-button:hover {
            background-color: var(--primary-color);
            color: var(--darker-bg);
        }

        .difficulty-tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .difficulty-easy {
            background-color: rgba(0, 255, 0, 0.2);
            border: 1px solid #0f0;
            color: #0f0;
        }

        .difficulty-medium {
            background-color: rgba(255, 255, 0, 0.2);
            border: 1px solid #ff0;
            color: #ff0;
        }

        .difficulty-hard {
            background-color: rgba(255, 0, 0, 0.2);
            border: 1px solid #f00;
            color: #f00;
        }

        .encounter-participants {
            margin-bottom: 15px;
        }

        .encounter-detail {
            margin-bottom: 10px;
        }

        .encounter-detail-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .encounter-rewards {
            color: var(--secondary-color);
            font-style: italic;
            margin-top: 15px;
        }

        .actions-row {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .save-all-button, .clear-button {
            flex: 1;
            margin: 0 10px;
        }

        .stats-box {
            background-color: rgba(255, 0, 170, 0.1);
            border: 1px solid var(--secondary-color);
            border-radius: 5px;
            padding: 10px;
            margin-top: 15px;
        }

        .stats-title {
            color: var(--secondary-color);
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }

        .stats-value {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .stats-label {
            width: 120px;
            font-size: 0.9rem;
        }

        .stats-bar {
            flex-grow: 1;
            height: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            overflow: hidden;
        }

        .stats-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 5px;
        }

        .stats-number {
            width: 30px;
            text-align: right;
            margin-left: 10px;
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="images/oce_logo.png" alt="OmniCorp Entertainment Logo" class="logo">
                <div class="title-container">
                    <h1>ULTIMATE MERCENARY</h1>
                    <h2>Generador de Encuentros</h2>
                </div>
            </div>
            <div class="return-button-container">
                <a href="index.html" class="return-button"><i class="fas fa-arrow-left"></i> Volver al Inicio</a>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> Inicio</a></li>
                    <li><a href="character-sheet.html"><i class="fas fa-user"></i> Hoja de Personaje</a></li>
                    <li><a href="dice-roller.html"><i class="fas fa-dice"></i> Lanzador de Dados</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <div class="encounter-container">
                <div class="encounter-header">
                    <h2>Generador de Encuentros para Ultimate Mercenary</h2>
                </div>
                
                <div class="encounter-form">
                    <form id="generator-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Escenario:</label>
                                <select class="form-select" id="scenario">
                                    <option value="obstacle">Carrera de Obstáculos</option>
                                    <option value="greenhouse">Invernaderos Abandonados</option>
                                    <option value="urban">Zona Urbana en Ruinas</option>
                                    <option value="facility">Instalación de OCE</option>
                                    <option value="dormitory">Dormitorios/Área Común</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tipo de Encuentro:</label>
                                <select class="form-select" id="encounter-type">
                                    <option value="combat">Combate</option>
                                    <option value="exploration">Exploración</option>
                                    <option value="social">Social</option>
                                    <option value="challenge">Desafío Técnico</option>
                                    <option value="mixed">Mixto</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Número de Participantes:</label>
                                <input type="number" class="form-input" id="participants" min="1" value="3">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Dificultad:</label>
                                <select class="form-select" id="difficulty">
                                    <option value="easy">Fácil</option>
                                    <option value="medium" selected>Media</option>
                                    <option value="hard">Difícil</option>
                                    <option value="deadly">Mortal</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Elementos Especiales:</label>
                                <select class="form-select" id="special-elements">
                                    <option value="none">Ninguno</option>
                                    <option value="trap">Trampas/Peligros</option>
                                    <option value="reward">Recompensas Especiales</option>
                                    <option value="environment">Condiciones Ambientales</option>
                                    <option value="time">Restricción de Tiempo</option>
                                    <option value="random">Aleatorio</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Puntos de Mérito en Juego:</label>
                                <input type="number" class="form-input" id="merit-points" min="0" value="100">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notas Adicionales (opcional):</label>
                            <input type="text" class="form-input" id="notes" placeholder="Cualquier información adicional...">
                        </div>
                        
                        <button type="submit" class="form-button" id="generate-button">Generar Encuentro</button>
                    </form>
                </div>
                
                <div class="encounter-results" id="results-container">
                    <!-- Las tarjetas de encuentros generados se insertarán aquí -->
                </div>
                
                <div class="actions-row">
                    <button class="form-button save-all-button" id="save-all">Guardar Todos los Encuentros</button>
                    <button class="form-button clear-button" id="clear-all">Limpiar Resultados</button>
                </div>
            </div>
        </main>

        <footer>
            <p>Ultimate Mercenary: La Forja del Acero Callejero &copy; 2025</p>
            <p>Basado en Eclipse Phase Segunda Edición</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('generator-form');
            const resultsContainer = document.getElementById('results-container');
            
            // Contador para llevar un id único para cada encuentro
            let encounterCount = 0;
            
            // Event listeners para los botones principales
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                generateEncounter();
            });
            
            document.getElementById('save-all').addEventListener('click', function() {
                saveAllEncounters();
            });
            
            document.getElementById('clear-all').addEventListener('click', function() {
                if (confirm('¿Estás seguro de que quieres limpiar todos los encuentros generados?')) {
                    resultsContainer.innerHTML = '';
                    encounterCount = 0;
                }
            });
            
            // Función principal para generar un encuentro
            function generateEncounter() {
                // Obtener todos los valores del formulario
                const scenario = document.getElementById('scenario').value;
                const encounterType = document.getElementById('encounter-type').value;
                const participants = parseInt(document.getElementById('participants').value);
                const difficulty = document.getElementById('difficulty').value;
                const specialElements = document.getElementById('special-elements').value;
                const meritPoints = parseInt(document.getElementById('merit-points').value);
                const notes = document.getElementById('notes').value;
                
                // Generar los datos del encuentro
                const encounter = createEncounterData(
                    scenario, 
                    encounterType, 
                    participants, 
                    difficulty, 
                    specialElements, 
                    meritPoints, 
                    notes
                );
                
                // Crear la tarjeta de encuentro
                const card = createEncounterCard(encounter);
                
                // Añadir la tarjeta al contenedor
                resultsContainer.prepend(card);
                
                // Incrementar el contador
                encounterCount++;
                
                // Limpiar campo de notas
                document.getElementById('notes').value = '';
            }
            
            // Función para crear los datos de un encuentro
            function createEncounterData(scenario, type, participants, difficulty, special, points, notes) {
                // Mapeo de nombres de escenarios
                const scenarioNames = {
                    obstacle: "Carrera de Obstáculos",
                    greenhouse: "Invernaderos Abandonados",
                    urban: "Zona Urbana en Ruinas",
                    facility: "Instalación de OCE",
                    dormitory: "Dormitorios/Área Común"
                };
                
                // Mapeo de nombres de tipos de encuentro
                const typeNames = {
                    combat: "Combate",
                    exploration: "Exploración",
                    social: "Social",
                    challenge: "Desafío Técnico",
                    mixed: "Mixto"
                };
                
                // Mapeo de nombres de dificultad
                const difficultyNames = {
                    easy: "Fácil",
                    medium: "Media",
                    hard: "Difícil",
                    deadly: "Mortal"
                };
                
                // Bases de estadísticas por dificultad
                const statsBases = {
                    easy: { combat: 30, tech: 25, social: 35, perception: 40 },
                    medium: { combat: 50, tech: 45, social: 50, perception: 50 },
                    hard: { combat: 70, tech: 60, social: 65, perception: 60 },
                    deadly: { combat: 90, tech: 80, social: 75, perception: 75 }
                };
                
                // Ajustar stats según el tipo de encuentro
                let stats = {...statsBases[difficulty]};
                if (type === 'combat') {
                    stats.combat += 10;
                    stats.tech -= 5;
                } else if (type === 'challenge') {
                    stats.tech += 15;
                    stats.combat -= 5;
                } else if (type === 'social') {
                    stats.social += 15;
                    stats.combat -= 10;
                } else if (type === 'exploration') {
                    stats.perception += 15;
                    stats.social -= 5;
                }
                
                // Limitar stats entre 10 y 95
                Object.keys(stats).forEach(key => {
                    stats[key] = Math.max(10, Math.min(95, stats[key]));
                });
                
                // Generar participantes basados en el escenario y tipo
                const participantsList = generateParticipants(scenario, type, participants, difficulty);
                
                // Generar desafíos basados en el tipo y dificultad
                const challenges = generateChallenges(type, difficulty, special);
                
                // Generar recompensas
                const rewards = generateRewards(difficulty, points, special);
                
                // Generar complicaciones potenciales
                const complications = generateComplications(difficulty, special);
                
                // Crear el objeto de encuentro
                return {
                    id: `encounter-${Date.now()}-${encounterCount}`,
                    title: generateEncounterTitle(type, scenario, difficulty),
                    scenario: scenarioNames[scenario],
                    type: typeNames[type],
                    difficulty: difficultyNames[difficulty],
                    difficultyClass: `difficulty-${difficulty}`,
                    participants: participantsList,
                    challenges: challenges,
                    rewards: rewards,
                    complications: complications,
                    stats: stats,
                    notes: notes,
                    special: special,
                    timestamp: new Date().toLocaleString()
                };
            }
            
            // Función para generar un título evocativo para el encuentro
            function generateEncounterTitle(type, scenario, difficulty) {
                // Arrays de palabras por tipo
                const combatWords = ["Emboscada", "Confrontación", "Asalto", "Defensa", "Ataque", "Duelo", "Enfrentamiento"];
                const explorationWords = ["Exploración", "Descubrimiento", "Incursión", "Infiltración", "Reconocimiento"];
                const socialWords = ["Negociación", "Encuentro", "Alianza", "Traición", "Pacto"];
                const challengeWords = ["Enigma", "Desafío", "Prueba", "Obstáculo", "Bloqueo"];
                const mixedWords = ["Operación", "Misión", "Aventura", "Situación", "Crisis"];
                
                // Arrays de adjetivos por dificultad
                const easyAdjectives = ["Simple", "Menor", "Básica", "Casual"];
                const mediumAdjectives = ["Tensa", "Peligrosa", "Arriesgada", "Comprometida"];
                const hardAdjectives = ["Crítica", "Extrema", "Mortal", "Desesperada"];
                const deadlyAdjectives = ["Catastrófica", "Devastadora", "Terminal", "Apocalíptica"];
                
                // Elegir palabras según el tipo
                let words;
                switch (type) {
                    case 'combat': words = combatWords; break;
                    case 'exploration': words = explorationWords; break;
                    case 'social': words = socialWords; break;
                    case 'challenge': words = challengeWords; break;
                    case 'mixed': words = mixedWords; break;
                    default: words = mixedWords;
                }
                
                // Elegir adjetivos según la dificultad
                let adjectives;
                switch (difficulty) {
                    case 'easy': adjectives = easyAdjectives; break;
                    case 'medium': adjectives = mediumAdjectives; break;
                    case 'hard': adjectives = hardAdjectives; break;
                    case 'deadly': adjectives = deadlyAdjectives; break;
                    default: adjectives = mediumAdjectives;
                }
                
                // Seleccionar aleatoriamente
                const word = words[Math.floor(Math.random() * words.length)];
                const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
                
                // Construir y devolver el título
                return `${word} ${adjective}`;
            }
            
            // Función para generar los participantes del encuentro
            function generateParticipants(scenario, type, count, difficulty) {
                // Bases de participantes por escenario
                const scenarioParticipants = {
                    obstacle: [
                        "Dron Araña de Vigilancia", 
                        "Guardia de Seguridad OCE", 
                        "Concursante Desesperado", 
                        "Grupo de Concursantes Aliados"
                    ],
                    greenhouse: [
                        "Cosechador Reptante", 
                        "Agro-Drone Defectuoso", 
                        "Terror-Maíz (Alfa)", 
                        "Concursante Escondido"
                    ],
                    urban: [
                        "Patrulla OCE", 
                        "Dron Watcher", 
                        "Concursantes Rivales", 
                        "Superviviente Civil"
                    ],
                    facility: [
                        "Guardia de Élite OCE", 
                        "Sistema de Seguridad Automatizado", 
                        "Técnico de OCE", 
                        "Concursante Infiltrado"
                    ],
                    dormitory: [
                        "Concursantes Desconfiados", 
                        "Alianza Temporal", 
                        "Espía de OCE", 
                        "Cámara de Vigilancia"
                    ]
                };
                
                // Tipos específicos por tipo de encuentro
                const encounterTypeParticipants = {
                    combat: ["Mercenario", "Tirador", "Berserker", "Unidad de Élite"],
                    exploration: ["Dron de Reconocimiento", "Trampa Activa", "Sensor de Movimiento"],
                    social: ["Informante", "Aliado Potencial", "Rival con Información", "Traidor"],
                    challenge: ["IA de Seguridad", "Cerradura Avanzada", "Sistema Inestable", "Terminal Comprometida"],
                    mixed: ["Agente Encubierto", "Superviviente Herido", "Asesino Silencioso", "Técnico Neutral"]
                };
                
                // Participantes específicos por dificultad
                const difficultyParticipants = {
                    easy: ["Oponente Inexperto", "Guardia Novato", "Sistema Básico"],
                    medium: ["Oponente Competente", "Guardia Entrenado", "Sistema Estándar"],
                    hard: ["Oponente Experimentado", "Guardia Veterano", "Sistema Avanzado"],
                    deadly: ["Oponente de Élite", "Guardia Especialista", "Sistema Militarizado"]
                };
                
                // Combinar y seleccionar participantes
                let possibleParticipants = [
                    ...scenarioParticipants[scenario],
                    ...encounterTypeParticipants[type],
                    ...difficultyParticipants[difficulty]
                ];
                
                let selectedParticipants = [];
                
                // Asegurar al menos uno del escenario y uno del tipo de encuentro
                selectedParticipants.push(
                    scenarioParticipants[scenario][Math.floor(Math.random() * scenarioParticipants[scenario].length)]
                );
                
                selectedParticipants.push(
                    encounterTypeParticipants[type][Math.floor(Math.random() * encounterTypeParticipants[type].length)]
                );
                
                // Seleccionar el resto aleatoriamente
                while (selectedParticipants.length < count) {
                    const randomParticipant = possibleParticipants[Math.floor(Math.random() * possibleParticipants.length)];
                    // Evitar duplicados exactos
                    if (!selectedParticipants.includes(randomParticipant)) {
                        selectedParticipants.push(randomParticipant);
                    }
                }
                
                // Mezclar el array final
                return shuffleArray(selectedParticipants.slice(0, count));
            }
            
            // Función para generar desafíos
            function generateChallenges(type, difficulty, special) {
                const numChallenges = difficulty === 'easy' ? 1 : (difficulty === 'medium' ? 2 : 3);
                
                // Bases de desafíos por tipo
                const typeChallenges = {
                    combat: [
                        "Enemigos emboscados con ventaja tácticas",
                        "Zonas de fuego cruzado",
                        "Cobertura limitada",
                        "Visibilidad reducida",
                        "Munición escasa"
                    ],
                    exploration: [
                        "Pasaje bloqueado que requiere ruta alternativa",
                        "Área con sensores de movimiento",
                        "Zona inestable con riesgo de colapso",
                        "Sistema de navegación interferido",
                        "Mapa corrupto o incompleto"
                    ],
                    social: [
                        "Encontrar información clave entre mentiras",
                        "Convencer a un grupo desconfiado",
                        "Negociar en situación de desventaja",
                        "Identificar al traidor en un grupo",
                        "Establecer alianza temporal con oponentes"
                    ],
                    challenge: [
                        "Hackear sistema con tiempo limitado",
                        "Desactivar trampa explosiva",
                        "Reparar equipo dañado con herramientas improvisadas",
                        "Obtener acceso a zona restringida",
                        "Descifrar código o mensaje crítico"
                    ],
                    mixed: [
                        "Combinación de combate mientras se hackea sistema",
                        "Negociación bajo amenaza de violencia",
                        "Reparación mientras se defiende posición",
                        "Infiltración en territorio hostil",
                        "Escolta de objetivo vulnerable"
                    ]
                };
                
                // Modificadores por elementos especiales
                if (special === 'trap') {
                    typeChallenges[type].push(
                        "Trampa de alta tecnología en el camino",
                        "Sistema de seguridad automatizado activo",
                        "Mecanismo de defensa letal camuflado"
                    );
                } else if (special === 'environment') {
                    typeChallenges[type].push(
                        "Zona con radiación residual",
                        "Exposición a toxinas ambientales",
                        "Tormenta eléctrica que interfiere electrónica",
                        "Gravedad alterada o inestable"
                    );
                } else if (special === 'time') {
                    typeChallenges[type].push(
                        "Temporizador de autodestrucción activo",
                        "Ventana de oportunidad extremadamente corta",
                        "Sistema con bloqueo progresivo"
                    );
                }
                
                // Seleccionar desafíos
                let challenges = [];
                const availableChallenges = [...typeChallenges[type]];
                
                for (let i = 0; i < numChallenges; i++) {
                    if (availableChallenges.length > 0) {
                        const index = Math.floor(Math.random() * availableChallenges.length);
                        challenges.push(availableChallenges[index]);
                        availableChallenges.splice(index, 1);
                    }
                }
                
                return challenges;
            }
            
            // Función para generar recompensas
            function generateRewards(difficulty, basePoints, special) {
                // Multiplicador de puntos por dificultad
                const pointsMultiplier = {
                    easy: 1,
                    medium: 1.5,
                    hard: 2,
                    deadly: 3
                };
                
                // Recompensas base según dificultad
                const rewards = [];
                
                // Puntos de mérito
                const meritPoints = Math.round(basePoints * pointsMultiplier[difficulty]);
                rewards.push(`${meritPoints} Puntos de Mérito`);
                
                // Probabilidades de items según dificultad
                const rewardChances = {
                    easy: 0.3,
                    medium: 0.5,
                    hard: 0.7,
                    deadly: 0.9
                };
                
                // Posibles items de recompensa
                const possibleItems = [
                    "Kit Médico",
                    "Munición Especial",
                    "Pieza de Armadura",
                    "Arma Mejorada",
                    "Implante Básico",
                    "Dispositivo Tecnológico",
                    "Información Valiosa",
                    "Mejora de Reputación con OCE"
                ];
                
                // Añadir recompensas especiales para elementos especiales "reward"
                if (special === 'reward') {
                    possibleItems.push(
                        "Implante Cibernético Raro",
                        "Arma Experimental",
                        "Datos Clasificados de OCE",
                        "Prototipo de Tecnología Avanzada",
                        "Token de Participación Directa con Kaiser"
                    );
                }
                
                // Añadir items según probabilidad
                if (Math.random() < rewardChances[difficulty]) {
                    const item = possibleItems[Math.floor(Math.random() * possibleItems.length)];
                    rewards.push(item);
                    
                    // En dificultades altas, hay probabilidad de item adicional
                    if (difficulty === 'hard' || difficulty === 'deadly') {
                        if (Math.random() < 0.4) {
                            let secondItem;
                            do {
                                secondItem = possibleItems[Math.floor(Math.random() * possibleItems.length)];
                            } while (secondItem === item);
                            rewards.push(secondItem);
                        }
                    }
                }
                
                return rewards;
            }
            
            // Función para generar complicaciones potenciales
            function generateComplications(difficulty, special) {
                // Número de complicaciones basado en dificultad
                const numComplications = {
                    easy: 0,
                    medium: 1,
                    hard: 1,
                    deadly: 2
                };
                
                // Si no hay complicaciones para esta dificultad, retornar vacío
                if (numComplications[difficulty] === 0) {
                    return [];
                }
                
                // Lista de posibles complicaciones
                const possibleComplications = [
                    "Intervención imprevista de Kaiser cambiando las reglas",
                    "Traición de un aliado aparente",
                    "Fallo en equipo crítico durante el encuentro",
                    "Llegada de refuerzos enemigos",
                    "Condiciones ambientales que empeoran progresivamente",
                    "Interrupción del flujo de información/comunicaciones",
                    "Timer oculto que reduce el tiempo disponible",
                    "Objetivo secundario que complica el principal",
                    "Participante con motivaciones ocultas"
                ];
                
                // Añadir complicaciones específicas para elementos especiales
                if (special === 'trap') {
                    possibleComplications.push(
                        "Trampa secundaria oculta",
                        "Sistema de contramedidas que se activa al desactivar la trampa principal"
                    );
                } else if (special === 'environment') {
                    possibleComplications.push(
                        "Tormenta que empeora y causa daño",
                        "Derrumbe o inundación repentina"
                    );
                } else if (special === 'time') {
                    possibleComplications.push(
                        "Aceleración del temporizador",
                        "Objetivo que se mueve/cambia con el tiempo"
                    );
                }
                
                // Seleccionar complicaciones
                let complications = [];
                const availableComplications = [...possibleComplications];
                
                for (let i = 0; i < numComplications[difficulty]; i++) {
                    if (availableComplications.length > 0) {
                        const index = Math.floor(Math.random() * availableComplications.length);
                        complications.push(availableComplications[index]);
                        availableComplications.splice(index, 1);
                    }
                }
                
                return complications;
            }
            
            // Función para crear una tarjeta de encuentro HTML
            function createEncounterCard(encounter) {
                const card = document.createElement('div');
                card.className = 'encounter-card';
                card.id = encounter.id;
                
                // Crear la cabecera de la tarjeta
                const header = document.createElement('div');
                header.className = 'encounter-card-header';
                header.innerHTML = `
                    <h3 class="encounter-card-title">
                        ${encounter.title}
                        <span class="difficulty-tag ${encounter.difficultyClass}">${encounter.difficulty}</span>
                    </h3>
                `;
                card.appendChild(header);
                
                // Crear el cuerpo de la tarjeta
                const body = document.createElement('div');
                body.className = 'encounter-card-body';
                
                // Añadir escenario y tipo
                body.innerHTML = `
                    <div class="encounter-detail">
                        <span class="encounter-detail-title">Escenario:</span>
                        ${encounter.scenario}
                    </div>
                    <div class="encounter-detail">
                        <span class="encounter-detail-title">Tipo:</span>
                        ${encounter.type}
                    </div>
                `;
                
                // Añadir participantes
                const participantsDiv = document.createElement('div');
                participantsDiv.className = 'encounter-participants';
                participantsDiv.innerHTML = `
                    <div class="encounter-detail-title">Participantes:</div>
                    <ul>
                        ${encounter.participants.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                `;
                body.appendChild(participantsDiv);
                
                // Añadir desafíos
                if (encounter.challenges.length > 0) {
                    const challengesDiv = document.createElement('div');
                    challengesDiv.className = 'encounter-challenges';
                    challengesDiv.innerHTML = `
                        <div class="encounter-detail-title">Desafíos:</div>
                        <ul>
                            ${encounter.challenges.map(c => `<li>${c}</li>`).join('')}
                        </ul>
                    `;
                    body.appendChild(challengesDiv);
                }
                
                // Añadir complicaciones
                if (encounter.complications.length > 0) {
                    const complicationsDiv = document.createElement('div');
                    complicationsDiv.className = 'encounter-complications';
                    complicationsDiv.innerHTML = `
                        <div class="encounter-detail-title">Complicaciones Potenciales:</div>
                        <ul>
                            ${encounter.complications.map(c => `<li>${c}</li>`).join('')}
                        </ul>
                    `;
                    body.appendChild(complicationsDiv);
                }
                
                // Añadir recompensas
                const rewardsDiv = document.createElement('div');
                rewardsDiv.className = 'encounter-rewards';
                rewardsDiv.innerHTML = `
                    <div class="encounter-detail-title">Recompensas:</div>
                    <ul>
                        ${encounter.rewards.map(r => `<li>${r}</li>`).join('')}
                    </ul>
                `;
                body.appendChild(rewardsDiv);
                
                // Añadir notas si existen
                if (encounter.notes) {
                    const notesDiv = document.createElement('div');
                    notesDiv.className = 'encounter-notes';
                    notesDiv.innerHTML = `
                        <div class="encounter-detail-title">Notas:</div>
                        <p>${encounter.notes}</p>
                    `;
                    body.appendChild(notesDiv);
                }
                
                // Añadir caja de estadísticas
                const statsBox = document.createElement('div');
                statsBox.className = 'stats-box';
                statsBox.innerHTML = `
                    <div class="stats-title">Estadísticas Recomendadas</div>
                    
                    <div class="stats-value">
                        <div class="stats-label">Combate:</div>
                        <div class="stats-bar">
                            <div class="stats-bar-fill" style="width: ${encounter.stats.combat}%;"></div>
                        </div>
                        <div class="stats-number">${encounter.stats.combat}</div>
                    </div>
                    
                    <div class="stats-value">
                        <div class="stats-label">Tecnología:</div>
                        <div class="stats-bar">
                            <div class="stats-bar-fill" style="width: ${encounter.stats.tech}%;"></div>
                        </div>
                        <div class="stats-number">${encounter.stats.tech}</div>
                    </div>
                    
                    <div class="stats-value">
                        <div class="stats-label">Social:</div>
                        <div class="stats-bar">
                            <div class="stats-bar-fill" style="width: ${encounter.stats.social}%;"></div>
                        </div>
                        <div class="stats-number">${encounter.stats.social}</div>
                    </div>
                    
                    <div class="stats-value">
                        <div class="stats-label">Percepción:</div>
                        <div class="stats-bar">
                            <div class="stats-bar-fill" style="width: ${encounter.stats.perception}%;"></div>
                        </div>
                        <div class="stats-number">${encounter.stats.perception}</div>
                    </div>
                `;
                body.appendChild(statsBox);
                
                card.appendChild(body);
                
                // Crear el footer
                const footer = document.createElement('div');
                footer.className = 'encounter-card-footer';
                footer.innerHTML = `
                    <span>${encounter.timestamp}</span>
                    <button class="save-button" data-id="${encounter.id}">Guardar</button>
                `;
                card.appendChild(footer);
                
                // Añadir evento para guardar individualmente
                card.querySelector('.save-button').addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    saveEncounter(id);
                });
                
                return card;
            }
            
            // Función para guardar un encuentro individual
            function saveEncounter(id) {
                const card = document.getElementById(id);
                if (!card) return;
                
                const header = card.querySelector('.encounter-card-header').textContent.trim();
                const body = card.querySelector('.encounter-card-body').innerHTML;
                
                const encounterHTML = `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <title>${header}</title>
                    <style>
                        body { font-family: Arial, sans-serif; background-color: #0a0a12; color: #e0e0ff; padding: 20px; }
                        .container { max-width: 800px; margin: 0 auto; background-color: #121224; padding: 20px; border-radius: 10px; }
                        h1 { color: #00f2ff; }
                        .difficulty-tag { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 0.8rem; margin-left: 10px; }
                        .difficulty-easy { background-color: rgba(0, 255, 0, 0.2); border: 1px solid #0f0; color: #0f0; }
                        .difficulty-medium { background-color: rgba(255, 255, 0, 0.2); border: 1px solid #ff0; color: #ff0; }
                        .difficulty-hard { background-color: rgba(255, 0, 0, 0.2); border: 1px solid #f00; color: #f00; }
                        .difficulty-deadly { background-color: rgba(255, 0, 0, 0.4); border: 1px solid #f00; color: #f00; }
                        .encounter-detail-title { font-weight: bold; color: #00f2ff; margin-bottom: 5px; }
                        .encounter-rewards { color: #ff00aa; font-style: italic; margin-top: 15px; }
                        .stats-box { background-color: rgba(255, 0, 170, 0.1); border: 1px solid #ff00aa; border-radius: 5px; padding: 10px; margin-top: 15px; }
                        .stats-title { color: #ff00aa; font-weight: bold; margin-bottom: 5px; text-align: center; }
                        .stats-value { display: flex; align-items: center; margin-bottom: 5px; }
                        .stats-label { width: 120px; font-size: 0.9rem; }
                        .stats-bar { flex-grow: 1; height: 10px; background-color: rgba(0, 0, 0, 0.5); border-radius: 5px; overflow: hidden; }
                        .stats-bar-fill { height: 100%; background-color: #00f2ff; border-radius: 5px; }
                        .stats-number { width: 30px; text-align: right; margin-left: 10px; font-size: 0.9rem; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>${header}</h1>
                        ${body}
                        <p style="margin-top: 20px; font-size: 0.8rem; text-align: center; color: #777;">
                            Generado por Ultimate Mercenary: La Forja del Acero Callejero <br>
                            Fecha: ${new Date().toLocaleString()}
                        </p>
                    </div>
                </body>
                </html>
                `;
                
                // Crear el blob y descargar
                const blob = new Blob([encounterHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `encuentro_${id}.html`;
                document.body.appendChild(a);
                a.click();
                
                // Limpiar
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }
            
            // Función para guardar todos los encuentros
            function saveAllEncounters() {
                const cards = document.querySelectorAll('.encounter-card');
                if (cards.length === 0) {
                    alert('No hay encuentros para guardar.');
                    return;
                }
                
                // Crear contenido para la página
                let allEncountersHTML = `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <title>Encuentros de Ultimate Mercenary</title>
                    <style>
                        body { font-family: Arial, sans-serif; background-color: #0a0a12; color: #e0e0ff; padding: 20px; }
                        .container { max-width: 800px; margin: 0 auto; background-color: #121224; padding: 20px; border-radius: 10px; }
                        h1, h2 { color: #00f2ff; }
                        .encounter { border: 1px solid #00f2ff; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
                        .encounter-header { background-color: rgba(0, 0, 0, 0.3); padding: 10px; margin: -15px -15px 15px -15px; border-radius: 10px 10px 0 0; border-bottom: 1px solid #00f2ff; }
                        .difficulty-tag { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 0.8rem; margin-left: 10px; }
                        .difficulty-easy { background-color: rgba(0, 255, 0, 0.2); border: 1px solid #0f0; color: #0f0; }
                        .difficulty-medium { background-color: rgba(255, 255, 0, 0.2); border: 1px solid #ff0; color: #ff0; }
                        .difficulty-hard { background-color: rgba(255, 0, 0, 0.2); border: 1px solid #f00; color: #f00; }
                        .difficulty-deadly { background-color: rgba(255, 0, 0, 0.4); border: 1px solid #f00; color: #f00; }
                        .encounter-detail-title { font-weight: bold; color: #00f2ff; margin-bottom: 5px; }
                        .encounter-rewards { color: #ff00aa; font-style: italic; margin-top: 15px; }
                        .stats-box { background-color: rgba(255, 0, 170, 0.1); border: 1px solid #ff00aa; border-radius: 5px; padding: 10px; margin-top: 15px; }
                        .stats-title { color: #ff00aa; font-weight: bold; margin-bottom: 5px; text-align: center; }
                        .stats-value { display: flex; align-items: center; margin-bottom: 5px; }
                        .stats-label { width: 120px; font-size: 0.9rem; }
                        .stats-bar { flex-grow: 1; height: 10px; background-color: rgba(0, 0, 0, 0.5); border-radius: 5px; overflow: hidden; }
                        .stats-bar-fill { height: 100%; background-color: #00f2ff; border-radius: 5px; }
                        .stats-number { width: 30px; text-align: right; margin-left: 10px; font-size: 0.9rem; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>Encuentros de Ultimate Mercenary</h1>
                        <p>Compilación de encuentros generados para la campaña.</p>
                `;
                
                // Añadir cada encuentro
                cards.forEach(card => {
                    const header = card.querySelector('.encounter-card-header').textContent.trim();
                    const body = card.querySelector('.encounter-card-body').innerHTML;
                    
                    allEncountersHTML += `
                        <div class="encounter">
                            <div class="encounter-header">
                                <h2>${header}</h2>
                            </div>
                            ${body}
                        </div>
                    `;
                });
                
                // Cerrar el HTML
                allEncountersHTML += `
                        <p style="margin-top: 20px; font-size: 0.8rem; text-align: center; color: #777;">
                            Generado por Ultimate Mercenary: La Forja del Acero Callejero <br>
                            Fecha: ${new Date().toLocaleString()}
                        </p>
                    </div>
                </body>
                </html>
                `;
                
                // Crear el blob y descargar
                const blob = new Blob([allEncountersHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `encuentros_ultimate_mercenary_${new Date().toISOString().slice(0, 10)}.html`;
                document.body.appendChild(a);
                a.click();
                
                // Limpiar
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }
            
            // Función auxiliar para mezclar un array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
        });
    </script>
</body>
</html>