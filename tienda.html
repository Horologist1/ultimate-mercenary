<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda - Ultimate Mercenary</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        .shop-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .shop-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .shop-tab {
            padding: 10px 20px;
            background-color: rgba(30, 30, 30, 0.8);
            border: 1px solid #444;
            border-radius: 4px;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shop-tab:hover {
            background-color: rgba(0, 204, 255, 0.1);
            border-color: #00ccff;
        }

        .shop-tab.active {
            background-color: rgba(0, 204, 255, 0.2);
            border-color: #00ccff;
            color: #00ccff;
        }

        .shop-section {
            display: none;
            margin-bottom: 40px;
        }

        .shop-section.active {
            display: block;
        }

        .shop-section h2 {
            color: #00ccff;
            font-family: 'Orbitron', sans-serif;
            border-bottom: 2px solid #00ccff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background-color: rgba(30, 30, 30, 0.8);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #444;
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .item-card:hover {
            transform: translateY(-5px);
        }

        .item-image {
            width: 200px;
            height: 200px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .item-image.placeholder {
            color: #666;
            font-size: 0.9em;
            text-align: center;
            padding: 20px;
        }

        .item-card h3 {
            color: #00ccff;
            margin: 0 0 10px 0;
            font-family: 'Orbitron', sans-serif;
        }

        .item-card p {
            color: #ccc;
            margin: 5px 0;
            flex-grow: 1;
        }

        .item-card .price {
            color: #ff4757;
            font-weight: bold;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .pm-display {
            background-color: rgba(30, 30, 30, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #444;
        }

        .pm-display h3 {
            color: #00ccff;
            margin: 0;
            font-family: 'Orbitron', sans-serif;
        }

        .buy-button {
            background-color: #ff4757;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        .buy-button:hover {
            background-color: #ff6b81;
        }

        .buy-button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        .purchase-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #00ccff;
            color: #00ccff;
            display: none;
            z-index: 1000;
        }

        .purchase-message a {
            color: #ff4757;
            text-decoration: none;
        }

        .purchase-message a:hover {
            text-decoration: underline;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .modal-header h2 {
            color: #00ccff;
            margin: 0;
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <script>
    // Permite a la tienda usar el sistema de transacciones del padre si est√° embebida
    let puenteActivo = false;
    if (!window.pmTransactions && window.parent && window.parent.pmTransactions) {
        window.pmTransactions = window.parent.pmTransactions;
        window.comprarItem = window.parent.comprarItem;
        window.sumarPM = window.parent.sumarPM;
        window.restarPM = window.parent.restarPM;
        puenteActivo = true;
    } else if (window.pmTransactions && window.comprarItem) {
        puenteActivo = true;
    }

    // Funci√≥n para actualizar la visualizaci√≥n de PM
    function updatePMDisplay() {
        const pmElement = document.getElementById('current-pm');
        if (pmElement) {
            const total = window.pmTransactions ? window.pmTransactions.getTotal() : 0;
            pmElement.textContent = total;
            
            // Actualizar estado de botones de compra
            document.querySelectorAll('.buy-button').forEach(button => {
                const item = button.closest('.item-card');
                if (item) {
                    const priceElement = item.querySelector('.price');
                    if (priceElement) {
                        const price = parseInt(priceElement.textContent);
                        button.disabled = total < price;
                    }
                }
            });
        }
    }

    // Escuchar mensajes del padre
    window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'updatePM') {
            updatePMDisplay();
        }
    });

    // Solicitar actualizaci√≥n inicial de PM
    if (window.parent) {
        window.parent.postMessage({ type: 'getPM' }, '*');
    }

    // Actualizar PM cada segundo para mantener sincronizaci√≥n
    setInterval(updatePMDisplay, 1000);

    // Inicializar Firebase solo si no estamos en un iframe
    if (!window.parent || window.parent === window) {
        const firebaseConfig = {
            apiKey: "AIzaSyBVc1a4E4_y-YJZV5ZqFQzTr1T8Txe8TmQ",
            authDomain: "ultimatemercenary-1e212.firebaseapp.com",
            projectId: "ultimatemercenary-1e212",
            storageBucket: "ultimatemercenary-1e212.appspot.com",
            messagingSenderId: "683730871364",
            appId: "1:683730871364:web:350aaf7a296ad34db28811",
            databaseURL: "https://ultimatemercenary-1e212-default-rtdb.firebaseio.com/"
        };

        if (!window.firebaseApp) {
            window.firebaseApp = firebase.initializeApp(firebaseConfig);
            window.database = firebase.database();
        }

        // Referencias a Firebase
        const pmRef = window.database.ref('playerPM');
        const itemsCompradosRef = window.database.ref('itemsComprados');

        // Listener para cambios en PM
        pmRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data !== null) {
                localStorage.setItem('playerPM', data.toString());
                updatePMDisplay();
            }
        });
    }
    </script>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="images/oce_logo.png" alt="OmniCorp Entertainment Logo" class="logo">
                <div class="title-container">
                    <h1>ULTIMATE MERCENARY</h1>
                    <h2>Tienda</h2>
                </div>
            </div>
        </header>

        <main>
            <div class="main-container">
                <div class="shop-container">
                    <div class="pm-display">
                        <h3><i class="fas fa-coins"></i> Puntos de M√©rito: <span id="current-pm">0</span></h3>
                    </div>

                    <div class="shop-tabs">
                        <!-- Las pesta√±as se cargar√°n din√°micamente -->
                    </div>

                    <div id="shop-sections">
                        <!-- Las secciones se cargar√°n din√°micamente -->
                    </div>
                </div>
            </div>
        </main>

        <div id="purchase-message" class="purchase-message"></div>

        <footer>
            <p>Ultimate Mercenary: La Forja del Acero Callejero &copy; 2025</p>
            <p>Basado en Eclipse Phase Segunda Edici√≥n</p>
        </footer>
    </div>

    <script>
        // Items predefinidos de la tienda
        const defaultShopItems = {
            'shop-armas': [
                {
                    'Art√≠culo': 'Pistola de Autodefensa "Pocket Pal Mk.II"',
                    'Descripci√≥n': 'Arma b√°sica de autodefensa entregada a todos los concursantes',
                    'Da√±o': '1d10',
                    'Notas': '6 balas, b√°sica',
                    'Coste': 0
                },
                {
                    'Art√≠culo': 'Cuchillo de Combate',
                    'Descripci√≥n': 'K-BAR 2100 Neo-Ceramic',
                    'Da√±o': '1d10+2',
                    'Notas': 'B√°sico pero fiable',
                    'Coste': 20
                },
                {
                    'Art√≠culo': 'Porra Retr√°ctil',
                    'Descripci√≥n': 'Titanio, extensible',
                    'Da√±o': '1d10+1',
                    'Notas': 'Aturdimiento',
                    'Coste': 40
                },
                {
                    'Art√≠culo': 'Katana Monomolecular',
                    'Descripci√≥n': '"Filo Espectral"',
                    'Da√±o': '2d10+2',
                    'Notas': 'AP -2, Exclusivo',
                    'Coste': 350
                },
                {
                    'Art√≠culo': 'Nudillos Cibern√©ticos',
                    'Descripci√≥n': '"Machacador" (Implante)',
                    'Da√±o': '1d10+3',
                    'Notas': '+10 a golpes',
                    'Coste': 150
                },
                {
                    'Art√≠culo': 'Pistola Ligera Est√°ndar',
                    'Descripci√≥n': 'Ronin Arms Type-12, 9mm',
                    'Da√±o': '2d10',
                    'Notas': 'Fiable, com√∫n',
                    'Coste': 75
                },
                {
                    'Art√≠culo': 'Pistola Pesada',
                    'Descripci√≥n': 'Ares "Predator V", .45',
                    'Da√±o': '2d10+2',
                    'Notas': 'AP -1',
                    'Coste': 150
                },
                {
                    'Art√≠culo': 'Pistola de Dardos',
                    'Descripci√≥n': 'Tranquilizantes (3 dardos)',
                    'Da√±o': 'Especial',
                    'Notas': 'Aturdimiento/Veneno',
                    'Coste': 120
                },
                {
                    'Art√≠culo': 'Subfusil Ligero',
                    'Descripci√≥n': 'Federated Arms Striker, 9mm',
                    'Da√±o': '2d10',
                    'Notas': 'R√°faga',
                    'Coste': 350
                },
                {
                    'Art√≠culo': 'Escopeta de Combate',
                    'Descripci√≥n': 'Ronin "Street Sweeper", Cal. 12',
                    'Da√±o': '3d10',
                    'Notas': 'Dispersi√≥n',
                    'Coste': 400
                },
                {
                    'Art√≠culo': 'Rifle de Asalto',
                    'Descripci√≥n': 'Militech "Ronin" M-77',
                    'Da√±o': '2d10+4',
                    'Notas': 'AP -2, Acceso Mayor',
                    'Coste': 600
                }
            ],
            'shop-municion': [
                {
                    'Art√≠culo': 'Cargador Pistola Ligera',
                    'Compatible con': 'Pistolas 9mm',
                    'Cantidad': '12 balas',
                    'Coste': 25
                },
                {
                    'Art√≠culo': 'Cargador Pistola Pesada',
                    'Compatible con': 'Pistolas .45',
                    'Cantidad': '10 balas',
                    'Coste': 35
                },
                {
                    'Art√≠culo': 'Cargador Subfusil',
                    'Compatible con': 'Subfusiles 9mm',
                    'Cantidad': '30 balas',
                    'Coste': 50
                },
                {
                    'Art√≠culo': 'Cartuchos Escopeta',
                    'Compatible con': 'Escopetas Cal. 12',
                    'Cantidad': '8 cartuchos',
                    'Coste': 40
                },
                {
                    'Art√≠culo': 'Cargador Rifle',
                    'Compatible con': 'Rifles de asalto',
                    'Cantidad': '20 balas',
                    'Coste': 70
                },
                {
                    'Art√≠culo': 'Munici√≥n Especial',
                    'Compatible con': 'Cualquier arma',
                    'Cantidad': 'AP, Expansiva, EMP',
                    'Coste': '50% extra'
                }
            ],
            'shop-cyberware': [
                {
                    'Art√≠culo': 'Ojo Cibern√©tico Avanzado',
                    'Descripci√≥n': 'HawkEye-3',
                    'Efectos': '+15 Percepci√≥n Visual, T√©rmica, EMF, Smartlink',
                    'Coste': 500
                },
                {
                    'Art√≠culo': 'Reflejos Cableados',
                    'Descripci√≥n': 'Lynx V.1',
                    'Efectos': '+5 Iniciativa, +10 Atletismo y Esquiva',
                    'Coste': 450
                },
                {
                    'Art√≠culo': 'Piel Subd√©rmica Blindada',
                    'Descripci√≥n': 'Armadura integrada',
                    'Efectos': 'Armadura +2/+2 natural',
                    'Coste': 600
                },
                {
                    'Art√≠culo': 'Procesador de Combate T√°ctico',
                    'Descripci√≥n': 'Ayuda en Punter√≠a/Esquiva',
                    'Efectos': '+5 a una habilidad de combate',
                    'Coste': 550
                },
                {
                    'Art√≠culo': 'Pulmones Filtradores Mejorados',
                    'Descripci√≥n': 'Sistema respiratorio avanzado',
                    'Efectos': 'Resistencia a toxinas, respirar bajo agua poco tiempo',
                    'Coste': 400
                },
                {
                    'Art√≠culo': 'Implante de Camuflaje √ìptico',
                    'Descripci√≥n': 'B√°sico, corta duraci√≥n',
                    'Efectos': 'Invisibilidad parcial (1 minuto), recarga lenta',
                    'Coste': 700
                }
            ],
            'shop-servicios': [
                {
                    'Servicio': 'Informaci√≥n Vaga sobre la Pr√≥xima Prueba',
                    'Descripci√≥n': 'Detalles generales, sin especificaciones',
                    'Coste': 150
                },
                {
                    'Servicio': 'Informaci√≥n Detallada',
                    'Descripci√≥n': 'Sobre un aspecto espec√≠fico de la pr√≥xima prueba',
                    'Coste': 300
                },
                {
                    'Servicio': 'Mapa Parcial',
                    'Descripci√≥n': 'Del √°rea de la pr√≥xima prueba',
                    'Coste': 250
                },
                {
                    'Servicio': '"Soborno" a un Guardia',
                    'Descripci√≥n': 'Para un peque√±o favor (arriesgado)',
                    'Coste': 100
                },
                {
                    'Servicio': 'Reserva de Funda Sint√©tica B√°sica',
                    'Descripci√≥n': 'En caso de muerte y si Kaiser lo aprueba',
                    'Coste': 1000
                }
            ],
            'shop-armaduras': [
                {
                    'Art√≠culo': 'Ropa Reforzada',
                    'Descripci√≥n': 'Aspecto de ropa normal pero con protecci√≥n',
                    'Armadura (K/E)': '2/2',
                    'Cobertura': 'Cuerpo',
                    'Coste': 50
                },
                {
                    'Art√≠culo': 'Chaleco Antibalas Ligero',
                    'Descripci√≥n': 'Aegis-Lite, discreto pero efectivo',
                    'Armadura (K/E)': '4/6',
                    'Cobertura': 'Torso',
                    'Coste': 120
                },
                {
                    'Art√≠culo': 'Chaleco Antibalas Medio',
                    'Descripci√≥n': 'Aegis Standard, protecci√≥n notable',
                    'Armadura (K/E)': '6/8',
                    'Cobertura': 'Torso',
                    'Coste': 250
                },
                {
                    'Art√≠culo': 'Traje de Combate Ligero',
                    'Descripci√≥n': 'Armadura integral con casco',
                    'Armadura (K/E)': '5/7',
                    'Cobertura': 'Cuerpo completo',
                    'Coste': 450
                },
                {
                    'Art√≠culo': 'Escudo Bal√≠stico Ligero',
                    'Descripci√≥n': 'Protecci√≥n m√≥vil',
                    'Armadura (K/E)': '8/10',
                    'Cobertura': 'Parcial (defensa)',
                    'Coste': 100
                }
            ],
            'shop-equipo': [
                {
                    'Art√≠culo': 'Kit M√©dico B√°sico',
                    'Descripci√≥n': '1x Trauma-Patch Plus',
                    'Efectos': 'Cura 1d10 PV',
                    'Coste': 60
                },
                {
                    'Art√≠culo': 'Kit M√©dico Avanzado',
                    'Descripci√≥n': 'Spray Medigel, Estimulantes, Analg√©sicos',
                    'Efectos': 'Cura 2d10 PV, reduce penalizadores',
                    'Coste': 150
                },
                {
                    'Art√≠culo': 'Multiherramienta',
                    'Descripci√≥n': 'Herramienta multifunci√≥n compacta',
                    'Efectos': '+10 a reparaciones b√°sicas',
                    'Coste': 30
                },
                {
                    'Art√≠culo': 'Cuerda (20m) con Gancho',
                    'Descripci√≥n': 'Fibra sint√©tica ultraresistente',
                    'Efectos': 'Facilita escaladas, soporta hasta 400kg',
                    'Coste': 40
                },
                {
                    'Art√≠culo': 'Gafas de Visi√≥n Nocturna/T√©rmica',
                    'Descripci√≥n': 'No requiere implante',
                    'Efectos': 'Visi√≥n en oscuridad/calor',
                    'Coste': 100
                },
                {
                    'Art√≠culo': 'Respirador',
                    'Descripci√≥n': 'Protecci√≥n gases b√°sicos',
                    'Efectos': '+10 vs. toxinas inhaladas',
                    'Coste': 70
                },
                {
                    'Art√≠culo': 'Datapad B√°sico',
                    'Descripci√≥n': 'Ordenador port√°til simple',
                    'Efectos': 'Funciones b√°sicas de informaci√≥n',
                    'Coste': 50
                },
                {
                    'Art√≠culo': 'Datapad Encriptado',
                    'Descripci√≥n': 'Con software de hacking b√°sico',
                    'Efectos': '+10 a intentos de hackeo',
                    'Coste': 200
                },
                {
                    'Art√≠culo': 'Cyberdeck "Shinigami Micro"',
                    'Descripci√≥n': 'Herramienta de hacking dedicada',
                    'Efectos': '+20 a intentos de hackeo, funciones avanzadas',
                    'Coste': 300
                },
                {
                    'Art√≠culo': 'Inhibidor de Se√±al',
                    'Descripci√≥n': 'Corto alcance, un solo uso',
                    'Efectos': 'Bloquea comunicaciones en 10m por 2 minutos',
                    'Coste': 120
                },
                {
                    'Art√≠culo': 'Micro-Dron de Reconocimiento',
                    'Descripci√≥n': 'B√°sico, tama√±o de un insecto',
                    'Efectos': 'Exploraci√≥n remota, transmisi√≥n de v√≠deo',
                    'Coste': 250
                }
            ]
        };

        // Cargar items desde localStorage o usar los predefinidos
        let shopItems = [];
        
        // Funci√≥n para cargar items guardados
        function loadSavedItems() {
            let savedItems = JSON.parse(localStorage.getItem('shopItems') || '{}');
            
            // Si no hay items guardados, usar los predefinidos
            if (Object.keys(savedItems).length === 0) {
                savedItems = defaultShopItems;
                localStorage.setItem('shopItems', JSON.stringify(defaultShopItems));
            }

            // Convertir el objeto de items en un array plano preservando todos los campos
            shopItems = Object.entries(savedItems).flatMap(([section, items]) => 
                items.map((item, index) => ({
                    id: `${section}-${index}`,
                    name: item.Art√≠culo || item.Servicio || '',
                    description: item.Descripci√≥n || '',
                    price: parseInt(item.Coste) || 0,
                    section: section,
                    // Preservar todos los campos originales
                    ...item
                }))
            );
        }

        // Funci√≥n para mostrar mensaje de compra
        function showPurchaseMessage(item) {
            const message = document.getElementById('purchase-message');
            message.innerHTML = `
                <h4>¬°Compra Exitosa!</h4>
                <p>Has adquirido: ${item.name}</p>
                <p><a href="#" onclick="showItemDetails('${item.id}')">Ver detalles del item</a></p>
            `;
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 5000);
        }

        // Funci√≥n para mostrar detalles del item
        function showItemDetails(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (item) {
                alert(`${item.name}\n\n${item.details}`);
            }
        }

        // Funci√≥n SIMPLIFICADA para comprar un item
        function buyItem(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (!item) return;

            console.log('üõí Intentando comprar:', item.name);

            const currentPM = window.pmTransactions ? window.pmTransactions.getTotal() : 0;
            if (currentPM >= item.price) {
                // Restar PM
                const comprarItemFn = window.parent.comprarItem || window.comprarItem;
                if (!comprarItemFn) {
                    alert('Error: Sistema de compras no disponible');
                    return;
                }
                
                const success = comprarItemFn(itemId, item.price);
                
                if (success) {
                    // Preparar el item con todos los datos disponibles
                    const fichaItem = {
                        nombre: item.name,
                        tipo: item.section.replace('shop-', ''),
                        descripcion: item.description || '',
                        detalles: item.details || '',
                        coste: item.price,
                        // Campos espec√≠ficos para armas
                        dano: item.damage || item['Da√±o'] || '',
                        ap: item.ap || item.AP || '',
                        alcance: item.range || item['Alcance'] || '',
                        municion: item.ammo || item['Munici√≥n'] || '',
                        notas: item.notes || item['Notas'] || item.details || '',
                        // Campos espec√≠ficos para armaduras
                        proteccion: item.armor || item['Armadura (K/E)'] || '',
                        cobertura: item.coverage || item['Cobertura'] || '',
                        // Campos espec√≠ficos para cyberware y equipo
                        efectos: item.effects || item['Efectos'] || '',
                        // Campos adicionales
                        compatible: item['Compatible con'] || '',
                        cantidad: item['Cantidad'] || '',
                        servicio: item['Servicio'] || '',
                        // Metadatos
                        fechaCompra: new Date().toISOString(),
                        origen: 'tienda'
                    };
                    
                    console.log('üì¶ Item a a√±adir:', fichaItem);
                    
                    // Obtener referencia a Firebase (priorizar parent)
                    const database = window.parent.database || window.database;
                    if (!database) {
                        alert('Error: Base de datos no disponible');
                        return;
                    }
                    
                    // Usar la funci√≥n simple del nuevo sistema
                    if (window.parent.addItemToInventory) {
                        window.parent.addItemToInventory(fichaItem);
                    } else {
                        // Fallback: escribir directamente a Firebase
                        const itemsCompradosRef = database.ref('itemsComprados');
                        itemsCompradosRef.transaction((currentData) => {
                            let items = [];
                            if (currentData && Array.isArray(currentData)) {
                                items = currentData;
                            }
                            items.push(fichaItem);
                            return items;
                        }).then(() => {
                            console.log('‚úÖ Item a√±adido a Firebase directamente');
                        });
                    }
                    
                    // Mostrar mensaje de √©xito
                    showPurchaseMessage(item);
                    updatePMDisplay();
                } else {
                    alert('Error en la transacci√≥n');
                }
            } else {
                alert('No tienes suficientes PM para realizar esta compra');
            }
        }

        // Funci√≥n para cargar la URL de imagen guardada
        function getItemImageUrl(itemName) {
            // Primero intentar obtener la imagen del localStorage (configurada en el admin)
            const savedUrl = localStorage.getItem(`product_image_url_${itemName}`);
            if (savedUrl) return savedUrl;
            
            // Si no hay URL configurada, usar la imagen local seg√∫n el tipo de item
            const defaultImages = {
                'Katana Monomolecular': 'images/katana.png',
                'Pistola Pesada': 'images/predator_pistol.png',
                'Escopeta de Combate': 'images/street_sweeper.png',
                'Ojo Cibern√©tico Avanzado': 'images/cybereye.png',
                'Reflejos Cableados': 'images/reflejos.png',
                'Piel Subd√©rmica Blindada': 'images/piel_armadura.png',
                'Procesador de Combate T√°ctico': 'images/procesador.png',
                'Pulmones Filtradores Mejorados': 'images/pulmones.png',
                'Implante de Camuflaje √ìptico': 'images/camuflaje.png',
                'Kit M√©dico Avanzado': 'images/kit_medico.png',
                'Cyberdeck "Shinigami Micro"': 'images/cyberdeck.png',
                'Micro-Dron de Reconocimiento': 'images/dron.png'
            };
            
            return defaultImages[itemName] || '';
        }

        // Funci√≥n para renderizar los items de la tienda
        function renderShopItems() {
            const sectionsContainer = document.getElementById('shop-sections');
            const tabsContainer = document.querySelector('.shop-tabs');
            const sections = {
                'shop-armas': 'Armas',
                'shop-municion': 'Munici√≥n',
                'shop-armaduras': 'Armaduras',
                'shop-cyberware': 'Cyberware',
                'shop-equipo': 'Equipo',
                'shop-servicios': 'Servicios'
            };

            // Renderizar pesta√±as
            tabsContainer.innerHTML = Object.entries(sections).map(([sectionId, sectionName], index) => `
                <div class="shop-tab ${index === 0 ? 'active' : ''}" data-section="${sectionId}">
                    ${sectionName}
                </div>
            `).join('');

            // Renderizar secciones
            sectionsContainer.innerHTML = Object.entries(sections).map(([sectionId, sectionName], index) => {
                const sectionItems = shopItems.filter(item => item.section === sectionId);
                if (sectionItems.length === 0) return '';

                return `
                    <div class="shop-section ${index === 0 ? 'active' : ''}" id="${sectionId}">
                        <div class="items-grid">
                            ${sectionItems.map(item => {
                                const imageUrl = getItemImageUrl(item.name);
                                return `
                                    <div class="item-card">
                                        <div class="item-image ${imageUrl ? '' : 'placeholder'}">
                                            ${imageUrl ? 
                                                `<img src="${imageUrl}" alt="${item.name}" onerror="this.parentElement.classList.add('placeholder'); this.parentElement.innerHTML = '<span>Error al cargar la imagen</span>';">` :
                                                `<span>Sin imagen</span>`
                                            }
                                        </div>
                                        <h3>${item.name}</h3>
                                        <p>${item.description}</p>
                                        ${(item.section === 'shop-armas' && item.damage) ? `<p><strong>Da√±o:</strong> ${item.damage}</p>` : ''}
                                        ${(item.section === 'shop-armas' && item.details) ? `<p><strong>Notas:</strong> ${item.details}</p>` : ''}
                                        ${(item.section === 'shop-armas' && item.notas) ? `<p><strong>Notas:</strong> ${item.notas}</p>` : ''}
                                        <p class="price">${item.price} PM</p>
                                        <button class="buy-button" data-item-id="${item.id}" onclick="buyItem('${item.id}')">
                                            Comprar
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            // A√±adir eventos a las pesta√±as
            document.querySelectorAll('.shop-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remover clase active de todas las pesta√±as y secciones
                    document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.shop-section').forEach(s => s.classList.remove('active'));
                    
                    // A√±adir clase active a la pesta√±a clickeada y su secci√≥n correspondiente
                    tab.classList.add('active');
                    const sectionId = tab.dataset.section;
                    document.getElementById(sectionId).classList.add('active');
                });
            });
        }

        // Inicializar la tienda
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedItems();
            renderShopItems();
            updatePMDisplay();
        });
    </script>
</body>
</html> 